<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compact Currency Converter</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --primary-dark: #45a049;
            --secondary-color: #e8f5e9;
            --text-color: #333;
            --border-radius: 6px;
            --box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            width: 100%;
            max-width: 350px;
            margin-bottom: 15px;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .input-group {
            margin-bottom: 15px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 3px;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.9em;
        }

        input,
        button {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            box-sizing: border-box;
            font-size: 14px;
        }

        input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        #result {
            font-size: 18px;
            color: var(--primary-color);
            text-align: center;
            margin-top: 15px;
        }

        .currency-inputs {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .currency-input {
            width: 45%;
        }

        #swap-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
            margin: 10px 10px -10px 10px;
        }

        #swap-button:hover {
            background-color: var(--primary-dark);
        }

        .currency-list {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
            max-height: 300px;
            overflow-y: auto;
        }

        .region-header {
            font-weight: bold;
            padding: 10px;
            background-color: #e9e9e9;
            cursor: default;
        }

        .currency-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
        }

        .currency-item:hover {
            background-color: #f1f1f1;
        }

        .currency-item img {
            margin-right: 5px;
        }

        .history-item {
            background: #f1f8e9;
            padding: 10px;
            margin: 8px 0;
            border-radius: var(--border-radius);
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .history-item:hover {
            background-color: #dcedc8;
        }

        #history-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        #history-controls button {
            width: 48%;
            padding: 12px;
            font-size: 14px;
        }

        .section-title {
            color: var(--primary-color);
            border-bottom: 1px solid var(--primary-color);
            padding-bottom: 5px;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Currency Converter</h1>
        <form id="converter-form">
            <div class="input-group">
                <label for="amount">Amount</label>
                <input type="number" id="amount" placeholder="Enter amount" required>
            </div>
            <div class="currency-inputs">
                <div class="currency-input">
                    <label for="from-currency">From Currency</label>
                    <div class="autocomplete">
                        <input type="text" id="from-currency" placeholder="e.g., USD" required>
                        <div id="from-currency-list" class="currency-list"></div>
                    </div>
                </div>
                <button type="button" id="swap-button" title="Swap currencies">â‡„</button>
                <div class="currency-input">
                    <label for="to-currency">To Currency</label>
                    <div class="autocomplete">
                        <input type="text" id="to-currency" placeholder="e.g., EUR" required>
                        <div id="to-currency-list" class="currency-list"></div>
                    </div>
                </div>
            </div>
            <button type="submit">Convert</button>
        </form>
        <div id="result"></div>
    </div>

    <div class="container">
        <h2 class="section-title">Conversion History</h2>
        <div id="history-list"></div>
        <div id="history-controls">
            <button id="clear-history">Clear</button>
            <button id="export-history">Export</button>
        </div>
    </div>

    <script>
        const form = document.getElementById('converter-form');
        const result = document.getElementById('result');
        const swapButton = document.getElementById('swap-button');
        const historyList = document.getElementById('history-list');
        const clearHistoryBtn = document.getElementById('clear-history');
        const exportHistoryBtn = document.getElementById('export-history');
        let conversionHistory = JSON.parse(localStorage.getItem('conversionHistory')) || [];

        const regions = {
            "North America": {
                "USD": "https://flagcdn.com/us.svg",
                "CAD": "https://flagcdn.com/ca.svg",
                "MXN": "https://flagcdn.com/mx.svg",
                "BSD": "https://flagcdn.com/bs.svg",
                "BZD": "https://flagcdn.com/bz.svg",
                "HTG": "https://flagcdn.com/ht.svg",
                "DOP": "https://flagcdn.com/do.svg",
                "JMD": "https://flagcdn.com/jm.svg",
                "TTD": "https://flagcdn.com/tt.svg"
            },
            "South America": {
                "ARS": "https://flagcdn.com/ar.svg",
                "BOB": "https://flagcdn.com/bo.svg",
                "BRL": "https://flagcdn.com/br.svg",
                "CLP": "https://flagcdn.com/cl.svg",
                "COP": "https://flagcdn.com/co.svg",
                "PEN": "https://flagcdn.com/pe.svg",
                "PYG": "https://flagcdn.com/py.svg",
                "UYU": "https://flagcdn.com/uy.svg",
                "VES": "https://flagcdn.com/ve.svg"
            },
            "Europe": {
                "EUR": "https://flagcdn.com/eu.svg",
                "GBP": "https://flagcdn.com/gb.svg",
                "CHF": "https://flagcdn.com/ch.svg",
                "NOK": "https://flagcdn.com/no.svg",
                "SEK": "https://flagcdn.com/se.svg",
                "DKK": "https://flagcdn.com/dk.svg",
                "CZK": "https://flagcdn.com/cz.svg",
                "PLN": "https://flagcdn.com/pl.svg",
                "HUF": "https://flagcdn.com/hu.svg",
                "RON": "https://flagcdn.com/ro.svg",
                "RUB": "https://flagcdn.com/ru.svg",
                "UAH": "https://flagcdn.com/ua.svg",
                "BYN": "https://flagcdn.com/by.svg",
                "RSD": "https://flagcdn.com/rs.svg",
                "MDL": "https://flagcdn.com/md.svg",
                "MKD": "https://flagcdn.com/mk.svg",
                "BAM": "https://flagcdn.com/ba.svg",
                "ALL": "https://flagcdn.com/al.svg",
                "GIP": "https://flagcdn.com/gi.svg",
                "ISK": "https://flagcdn.com/is.svg"
            },
            "Asia": {
                "CNY": "https://flagcdn.com/cn.svg",
                "JPY": "https://flagcdn.com/jp.svg",
                "INR": "https://flagcdn.com/in.svg",
                "KRW": "https://flagcdn.com/kr.svg",
                "IDR": "https://flagcdn.com/id.svg",
                "MYR": "https://flagcdn.com/my.svg",
                "THB": "https://flagcdn.com/th.svg",
                "SGD": "https://flagcdn.com/sg.svg",
                "TWD": "https://flagcdn.com/tw.svg",
                "VND": "https://flagcdn.com/vn.svg",
                "PKR": "https://flagcdn.com/pk.svg",
                "IQD": "https://flagcdn.com/iq.svg",
                "ILS": "https://flagcdn.com/il.svg",
                "AFN": "https://flagcdn.com/af.svg",
                "BDT": "https://flagcdn.com/bd.svg",
                "BHD": "https://flagcdn.com/bh.svg",
                "KHR": "https://flagcdn.com/kh.svg",
                "KGS": "https://flagcdn.com/kg.svg",
                "KWD": "https://flagcdn.com/kw.svg",
                "LAK": "https://flagcdn.com/la.svg",
                "LKR": "https://flagcdn.com/lk.svg",
                "MMK": "https://flagcdn.com/mm.svg",
                "MNT": "https://flagcdn.com/mn.svg",
                "NPR": "https://flagcdn.com/np.svg",
                "OMR": "https://flagcdn.com/om.svg",
                "QAR": "https://flagcdn.com/qa.svg",
                "SAR": "https://flagcdn.com/sa.svg",
                "SYP": "https://flagcdn.com/sy.svg",
                "TJS": "https://flagcdn.com/tj.svg",
                "TMT": "https://flagcdn.com/tm.svg",
                "UZS": "https://flagcdn.com/uz.svg",
                "YER": "https://flagcdn.com/ye.svg"
            },
            "Africa": {
                "ZAR": "https://flagcdn.com/za.svg",
                "EGP": "https://flagcdn.com/eg.svg",
                "NGN": "https://flagcdn.com/ng.svg",
                "KES": "https://flagcdn.com/ke.svg",
                "MAD": "https://flagcdn.com/ma.svg",
                "GHS": "https://flagcdn.com/gh.svg",
                "TND": "https://flagcdn.com/tn.svg",
                "XAF": "https://flagcdn.com/cm.svg",
                "XOF": "https://flagcdn.com/ci.svg",
                "AOA": "https://flagcdn.com/ao.svg",
                "BIF": "https://flagcdn.com/bi.svg",
                "CVE": "https://flagcdn.com/cv.svg",
                "DJF": "https://flagcdn.com/dj.svg",
                "ERN": "https://flagcdn.com/er.svg",
                "ETB": "https://flagcdn.com/et.svg",
                "GNF": "https://flagcdn.com/gn.svg",
                "LSL": "https://flagcdn.com/ls.svg",
                "LRD": "https://flagcdn.com/lr.svg",
                "MWK": "https://flagcdn.com/mw.svg",
                "MGA": "https://flagcdn.com/mg.svg",
                "MUR": "https://flagcdn.com/mu.svg",
                "MZN": "https://flagcdn.com/mz.svg",
                "RWF": "https://flagcdn.com/rw.svg",
                "SCR": "https://flagcdn.com/sc.svg",
                "SDG": "https://flagcdn.com/sd.svg",
                "SLL": "https://flagcdn.com/sl.svg",
                "SOS": "https://flagcdn.com/so.svg",
                "SSP": "https://flagcdn.com/ss.svg",
                "SZL": "https://flagcdn.com/sz.svg",
                "TZS": "https://flagcdn.com/tz.svg",
                "UGX": "https://flagcdn.com/ug.svg",
                "ZMW": "https://flagcdn.com/zm.svg",
                "ZWL": "https://flagcdn.com/zw.svg"
            }
        };

        function populateCurrencyList(currencyInput, currencyList) {
            currencyList.innerHTML = '';
            for (let [region, currencies] of Object.entries(regions)) {
                const regionHeader = document.createElement('div');
                regionHeader.className = 'region-header';
                regionHeader.textContent = region;
                currencyList.appendChild(regionHeader);

                for (let [code, flagUrl] of Object.entries(currencies)) {
                    const currencyItem = document.createElement('div');
                    currencyItem.className = 'currency-item';

                    const flagImg = document.createElement('img');
                    flagImg.src = flagUrl;
                    flagImg.alt = code;
                    flagImg.width = 20;
                    flagImg.height = 15;
                    flagImg.style.marginRight = '5px';

                    currencyItem.appendChild(flagImg);
                    currencyItem.appendChild(document.createTextNode(code));

                    currencyItem.addEventListener('click', function () {
                        currencyInput.value = code;
                        currencyList.style.display = 'none';
                    });
                    currencyList.appendChild(currencyItem);
                }
            }
        }

        function setupCurrencyInput(currencyInput, currencyList) {
            populateCurrencyList(currencyInput, currencyList);

            currencyInput.addEventListener('focus', function () {
                currencyList.style.display = 'block';
            });

            document.addEventListener('click', function (e) {
                if (!currencyInput.contains(e.target) && !currencyList.contains(e.target)) {
                    currencyList.style.display = 'none';
                }
            });
        }

        const fromCurrencyInput = document.getElementById('from-currency');
        const toCurrencyInput = document.getElementById('to-currency');
        const fromCurrencyList = document.getElementById('from-currency-list');
        const toCurrencyList = document.getElementById('to-currency-list');

        setupCurrencyInput(fromCurrencyInput, fromCurrencyList);
        setupCurrencyInput(toCurrencyInput, toCurrencyList);

        function updateHistoryDisplay() {
            historyList.innerHTML = '';
            conversionHistory.forEach((item, index) => {
                const historyItem = document.createElement('div');
                historyItem.classList.add('history-item');
                historyItem.textContent = `${item.amount} ${item.fromCurrency} = ${item.result} ${item.toCurrency}`;
                historyItem.addEventListener('click', () => fillFormFromHistory(item));
                historyList.appendChild(historyItem);
            });
        }

        function addToHistory(amount, fromCurrency, toCurrency, convertedAmount) {
            const newHistoryItem = {
                amount,
                fromCurrency,
                toCurrency,
                result: convertedAmount,
                date: new Date().toLocaleString()
            };

            const isDuplicate = conversionHistory.some(item =>
                item.amount === amount &&
                item.fromCurrency === fromCurrency &&
                item.toCurrency === toCurrency &&
                item.result === convertedAmount
            );

            if (!isDuplicate) {
                conversionHistory.unshift(newHistoryItem);
                if (conversionHistory.length > 20) {
                    conversionHistory.pop();
                }
                localStorage.setItem('conversionHistory', JSON.stringify(conversionHistory));
                updateHistoryDisplay();
            }
        }


        function fillFormFromHistory(item) {
            document.getElementById('amount').value = item.amount;
            document.getElementById('from-currency').value = item.fromCurrency;
            document.getElementById('to-currency').value = item.toCurrency;
        }

        function clearHistory() {
            conversionHistory = [];
            localStorage.removeItem('conversionHistory');
            updateHistoryDisplay();
        }

        function exportHistory() {
            const csvContent = "data:text/csv;charset=utf-8,"
                + "Amount,From Currency,To Currency,Result,Date\n"
                + conversionHistory.map(item => `${item.amount},${item.fromCurrency},${item.toCurrency},${item.result},${item.date}`).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "conversion_history.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function swapCurrencies() {
            const fromCurrency = document.getElementById('from-currency');
            const toCurrency = document.getElementById('to-currency');
            const temp = fromCurrency.value;
            fromCurrency.value = toCurrency.value;
            toCurrency.value = temp;
        }

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const amount = parseFloat(document.getElementById('amount').value);
            const fromCurrency = document.getElementById('from-currency').value.toUpperCase();
            const toCurrency = document.getElementById('to-currency').value.toUpperCase();

            try {
                const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${fromCurrency}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                const rate = data.rates[toCurrency];
                if (rate) {
                    const convertedAmount = (amount * rate).toFixed(2);
                    result.textContent = `${amount} ${fromCurrency} = ${convertedAmount} ${toCurrency}`;
                    addToHistory(amount, fromCurrency, toCurrency, convertedAmount);
                } else {
                    result.textContent = 'Invalid currency code';
                }
            } catch (error) {
                console.error('Fetch error:', error);
                result.textContent = 'Please enter the correct currency: ' + error.message;
            }
        });

        clearHistoryBtn.addEventListener('click', clearHistory);
        exportHistoryBtn.addEventListener('click', exportHistory);
        swapButton.addEventListener('click', swapCurrencies);


        updateHistoryDisplay();
    </script>
</body>

</html>